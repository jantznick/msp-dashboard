<%- include('partials/header') %>

<div class="max-w-3xl mx-auto py-10 px-4">
    <div class="text-center">
        <h1 class="text-4xl font-bold text-[secondary] mb-6">Add Users to a Tool</h1>
        <p class="mt-4 text-lg text-gray-500">Quickly request access for one or more users to an existing tool.</p>
    </div>

    <% if (submitted) { %>
        <div class="mt-8 bg-green-100 border border-green-200 text-green-800 px-6 py-4 rounded-lg relative text-center" role="alert">
            <strong class="font-bold">Success!</strong>
            <span class="block sm:inline">Your user request has been submitted.</span>
        </div>
    <% } %>

    <form action="/request" method="POST" class="mt-8 space-y-6 bg-white p-8 border border-gray-100 rounded-xl shadow-lg">
        <input type="hidden" name="requestType" value="Add Users">
        
        <div>
            <label for="products" class="block text-lg font-medium text-gray-700 mb-2">Select Tool(s)</label>
            <div class="space-y-2">
                <% 
                    const products = [
                        { name: 'Fastly NGWAF', slug: 'fastly-ngwaf' },
                        { name: 'Snyk', slug: 'snyk' },
                        { name: 'Tenable WAS (DAST Scanner)', slug: 'tenable-was' },
                        { name: 'Traceable API Security', slug: 'traceable-api-security' }
                    ];
                    products.forEach(product => { %>
                        <div class="flex items-center">
                            <input type="checkbox" id="<%= product.slug %>" name="products" value="<%= product.name %>" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <label for="<%= product.slug %>" class="ml-3 block text-md text-gray-700"><%= product.name %></label>
                        </div>
                    <% }); 
                %>
            </div>
        </div>

        <% if (user && applications.length > 0) { %>
            <div>
                <label for="applicationId" class="block text-lg font-medium text-gray-700">Application</label>
                <select id="applicationId" name="applicationId" class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary" required>
                    <option value="">Select an application</option>
                    <% applications.forEach(app => { %>
                        <option value="<%= app.id %>"><%= app.name %></option>
                    <% }) %>
                </select>
            </div>
        <% } else if (user) { %>
            <p class="text-gray-600">You are not associated with any applications. Please contact an admin to add applications to your company.</p>
        <% } %>

        <div>
            <label for="users" class="block text-lg font-medium text-gray-700">Users (comma-separated emails)</label>
            <textarea id="users" name="users" rows="4" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" placeholder="user1@example.com, user2@example.com"></textarea>
        </div>
        
        <% if (!user) { %>
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Your Email</label>
                <input type="email" id="email" name="email" value="" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
            </div>
        <% } %>

        <div>
            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                Submit User Request
            </button>
        </div>
    </form>
</div>

<%- include('partials/footer') %>